"use strict";

document.addEventListener("DOMContentLoaded", function () {
  //! Start Scripts

  const body = document.body; // переменная body

  // Запрет перетаскивания ссылок и картинок
  document.querySelectorAll("img, a").forEach((element) => {
    element.addEventListener("dragstart", (event) => {
      event.preventDefault();
    });
  });

  // /* ------------------- btnScrollTop -------------------- */
  const btnScrollTop = document.getElementById("btnScrollTop");
  window.onscroll = function () {
    scrollFunction();
  };

  function scrollFunction() {
    if (
      document.body.scrollTop > 20 ||
      document.documentElement.scrollTop > 20
    ) {
      btnScrollTop.classList.add("show");
    } else {
      btnScrollTop.classList.remove("show");
    }
  }
  btnScrollTop.addEventListener("click", function () {
    window.scrollTo({
      top: 0,
      left: 0,
      behavior: "smooth",
    });
  });

  //!Плавный скролл по якорным ссылкам
  const anchors = document.querySelectorAll('a[href*="#"]');
  anchors.forEach((anchor) => {
    anchor.addEventListener("click", (event) => {
      event.preventDefault();

      const blockID = anchor.getAttribute("href").substring(1);
      const targetElement = document.getElementById(blockID);

      if (targetElement) {
        targetElement.scrollIntoView({
          behavior: "smooth",
          block: "start",
        });
      }
    });
  });

  /* ------------------- Header Fixed -------------------- */
  const header = document.querySelector(".header");
  const headerHeight = header.offsetHeight;

  window.addEventListener("scroll", function () {
    if (window.scrollY > 74) {
      header.classList.add("header-fixed");
      document.body.style.paddingTop = headerHeight + "px";
    } else {
      header.classList.remove("header-fixed");
      document.body.style.paddingTop = 0;
    }
  });

  /* ------------------- Mail Header -------------------- */
  const mailHeader = document.querySelector(".mail__header");

  if (mailHeader) {
    const headerHeightMail = mailHeader.offsetHeight;

    window.addEventListener("scroll", function () {
      if (window.scrollY > 74) {
        mailHeader.classList.add("fixed");
        document.body.style.paddingTop = headerHeightMail + "px";
      } else {
        mailHeader.classList.remove("fixed");
        document.body.style.paddingTop = 0;
      }
    });
  }

  /* ------------------- Scroll to Mail Area -------------------- */
  const scrollButton = document.getElementById("btn-scrollMailArea");
  const mailArea = document.getElementById("mailArea");

  if (scrollButton && mailArea && mailHeader) {
    let isScrolling = false;

    window.addEventListener("scroll", function () {
      if (window.scrollY > 50) {
        scrollButton.classList.add("show");
      } else {
        if (!isScrolling) {
          scrollButton.classList.remove("show");
        }
      }
    });

    scrollButton.addEventListener("click", function () {
      isScrolling = true;
      window.scrollTo({
        top: mailArea.offsetTop - mailHeader.clientHeight,
        behavior: "smooth",
      });

      setTimeout(function () {
        isScrolling = false;
        scrollButton.classList.remove("show");
      }, 1000);
    });

    window.addEventListener("scroll", function () {
      if (!isScrolling) {
        scrollButton.classList.add("show");
      }
    });
  }

  /* ------------------- Прокрутка до MailArea -------------------- */
  if (mailArea) {
    const offset = 200;
    const targetOffset = mailArea.offsetTop - offset;

    window.scrollTo({
      top: targetOffset,
      behavior: "smooth",
    });
  }

  /* ------------------- Mob Menu -------------------- */
  const pageBody = document.querySelector(".page__body");
  const btnBurger = document.querySelector(".header__burger");
  const nav = document.querySelector(".header__nav");
  const navOverlay = document.querySelector(".nav-overlay");

  function toggleLockScroll() {
    pageBody.classList.toggle("lock-scroll");
  }

  if (nav && btnBurger) {
    btnBurger.addEventListener("click", () => {
      btnBurger.classList.toggle("active");
      nav.classList.toggle("active");
      navOverlay.classList.toggle("active");
      toggleLockScroll();
    });

    navOverlay.addEventListener("click", () => {
      toggleLockScroll();
      nav.classList.remove("active");
      btnBurger.classList.remove("active");
      navOverlay.classList.remove("active");
    });

    window.addEventListener("click", (e) => {
      const target = e.target;
      if (
        !target.closest(".header__nav") &&
        !target.closest(".header__burger") &&
        !target.closest(".nav-overlay") &&
        nav.classList.contains("active")
      ) {
        toggleLockScroll();
        nav.classList.remove("active");
        btnBurger.classList.remove("active");
        navOverlay.classList.remove("active");
      }
    });
  }

  /* ------------------- Footer Items Show is Mobile -------------------- */
  const footerToggle = document.querySelector(".footer__toggle");
  const footerTopContainer = document.querySelector(".footer__top-container");
  const footerMenuItems = document.querySelectorAll(".footer__menu-item");

  footerToggle.addEventListener("click", function () {
    footerMenuItems.forEach((item) => {
      item.classList.toggle("show");
    });
    footerToggle.classList.toggle("active");
    footerTopContainer.classList.toggle("open");
  });

  /* ------------------- Close system-message -------------------- */
  const closeMessage = document.querySelectorAll(".system-message__close");

  // Для каждого крестика закрытия назначаем обработчик события на клик
  closeMessage.forEach((button) => {
    button.addEventListener("click", function () {
      const parentMessage = button.closest(".system-message");
      parentMessage.style.display = "none";
    });
  });

  /* ------------------- Вывод текущей даты -------------------- */
  const currentDate = new Date();
  const time = currentDate.toLocaleTimeString("en-US", {
    hour: "2-digit",
    minute: "2-digit",
    hour12: false,
  });
  const day = currentDate.getDate();
  const month = currentDate.toLocaleString("en-US", { month: "long" });

  const formattedDate = `${time}, ${day} ${month}`;

  $(".today-date__info").text(formattedDate);

  /* ------------------- AirDatepicker -------------------- */
  $(document).ready(function () {
    const inputDate = $(".input-date");

    if (!inputDate.val()) {
      let currentDate = new Date().toISOString().slice(0, 10);
      inputDate.attr("placeholder", currentDate);
    }

    inputDate.datepicker({
      language: "en",
      autoClose: true,
      minDate: new Date(),
      dateFormat: "yyyy-mm-dd",
      onSelect: function (fd, date) {},
    });
  });

  /* ------------------- Select Item -------------------- */
  const checkboxesItem = document.querySelectorAll(".check__input");
  const selectAllCheckbox = document.querySelector(".check.select-all input");
  const checkboxesItemSelect = document.querySelectorAll(
    ".select-item .check__input"
  );

  checkboxesItem.forEach((checkbox) => {
    checkbox.addEventListener("change", function () {
      const photoItem = this.closest(".select-item");
      if (this.checked) {
        photoItem.style.border = "3px solid #2BAEEB";
      } else {
        photoItem.style.border = "none";
      }
    });
  });

  // Проверяем наличие элемента перед выполнением скпта
  if (document.querySelector(".select-item")) {
    selectAllCheckbox.addEventListener("change", function () {
      checkboxesItemSelect.forEach((checkbox) => {
        checkbox.checked = this.checked;
        const photoItem = checkbox.closest(".select-item");
        if (this.checked) {
          photoItem.style.border = "3px solid #2BAEEB";
        } else {
          photoItem.style.border = "none";
        }
      });

      checkboxesItemSelect.forEach((checkbox) => {
        checkbox.addEventListener("change", function () {
          if (!this.checked) {
            selectAllCheckbox.checked = false;
          }
        });
      });
    });
  }

  /* ------------------- Fancybox Gallery -------------------- */
  if ($(".fancybox").length > 0) {
    $(".fancybox").fancybox({
      width: 960,
      animationEffect: "fade",
      closeClick: true,
      clickOutside: "close",
    });
  }

  /* ------------------- Custom Select -------------------- */
  const customSelects = document.querySelectorAll(".select");

  customSelects.forEach((select) => {
    const selectTrigger = select.querySelector(".select__trigger");
    const optionsList = select.querySelector(".select__options");
    const options = optionsList.querySelectorAll(".select__option");
    const selected = select.querySelector(".select__selected");

    selectTrigger.addEventListener("click", () => {
      select.classList.toggle("open");
    });

    document.addEventListener("click", (event) => {
      if (!select.contains(event.target)) {
        select.classList.remove("open");
      }
    });

    options.forEach((option) => {
      option.addEventListener("click", () => {
        selected.textContent = option.textContent;
        options.forEach((otherOption) => {
          otherOption.classList.remove("selected");
        });
        option.classList.add("selected");
        select.classList.remove("open");
      });
    });
  });

  /* ------------------- Password Show -------------------- */
  const inputsPassword = document.querySelectorAll(".input-password");
  const passwordIcons = document.querySelectorAll(".password-icon");

  if (inputsPassword.length === passwordIcons.length) {
    passwordIcons.forEach((icon, index) => {
      icon.addEventListener("click", function () {
        inputsPassword[index].type =
          inputsPassword[index].type === "password" ? "text" : "password";
        icon.classList.toggle("password-show");
      });
    });
  }

  /* ------------------- Open filter in mobile -------------------- */
  const mobFilter = document.querySelector(".mob-selectfilter");
  const contentFilter = document.querySelector(".content-filter");

  if (mobFilter && contentFilter) {
    mobFilter.addEventListener("click", () => {
      mobFilter.classList.toggle("open");
      contentFilter.classList.toggle("active");
    });
  }

  /* ------------------- POPUP PROFILE LIKE -------------------- */
  const popupLike = document.querySelector(".popup-like");
  const popupLikeClose = document.querySelector(".popup-like__close");

  if (popupLike && popupLikeClose) {
    setTimeout(() => {
      popupLike.classList.add("show");
    }, 2000);

    setTimeout(() => {
      popupLike.classList.remove("show");
    }, 6000);

    popupLikeClose.addEventListener("click", () => {
      popupLike.classList.remove("show");
    });

    window.addEventListener("scroll", function () {
      if (window.scrollY > 16) {
        popupLike.classList.add("fixed");
      } else {
        popupLike.classList.remove("fixed");
      }
    });
  }

  /* ------------------- Tabs -------------------- */
  const tabsTriger = document.querySelectorAll(".tabs__triger");
  const tabsContentItem = document.querySelectorAll(".tabs__content-item");

  tabsTriger.forEach(onTabClick);

  function onTabClick(item) {
    item.addEventListener("click", function () {
      let currentBtn = item;
      let tabId = currentBtn.getAttribute("data-tab");
      let currentTab = document.querySelector(tabId);

      if (!currentBtn.classList.contains("active")) {
        tabsTriger.forEach(function (item) {
          item.classList.remove("active");
        });

        tabsContentItem.forEach(function (item) {
          item.classList.remove("active");
        });

        currentBtn.classList.add("active");
        currentTab.classList.add("active");
      }
    });
  }

  /* ------------------- Clamp Text -------------------- */
  const readMores = document.querySelectorAll(".read-more");

  readMores.forEach((readMore) => {
    readMore.addEventListener("click", function () {
      const text = readMore.previousElementSibling;
      text.classList.toggle("clamp-text");

      // Используем querySelector для получения первого элемента с классом "read-more__icon"
      const readMoreIcon = readMore.querySelector(".read-more__icon");

      if (text.classList.contains("clamp-text")) {
        readMoreIcon.style.transform = "none"; // Сбрасываем значение transform
      } else {
        readMoreIcon.style.transform = "rotate(180deg)";
      }
    });
  });

  /* ------------------- Btn Favorite -------------------- */
  const btnFavorites = document.querySelectorAll(".btn-favorite");
  btnFavorites.forEach((button) => {
    button.addEventListener("click", function () {
      button.classList.toggle("active");
    });
  });

  /* ------------------- Btn Folow -------------------- */
  const btnFolow = document.querySelectorAll(".btn-folow");
  btnFolow.forEach((button) => {
    button.addEventListener("click", function () {
      button.classList.toggle("active");
    });
  });

  /* ------------------- Profile Slider -------------------- */
  const profilesSliderTwo = new Swiper(".slider-profiles-two", {
    direction: "horizontal",
    loop: true,
    spaceBetween: 8,
    slidesPerView: 2,
    slidesPerGroup: 1,
    speed: 500,
    effect: "slider",

    autoplay: {
      delay: 3000,
      disableOnInteraction: true,
    },

    navigation: {
      nextEl: ".swiper-next",
      prevEl: ".swiper-prev",
    },

    pagination: {
      el: ".swiper-pagination",
      clickable: true,
    },

    on: {
      init() {
        this.el.addEventListener("mouseenter", () => {
          this.autoplay.stop();
        });

        this.el.addEventListener("mouseleave", () => {
          this.autoplay.start();
        });
      },
    },
  });

  const profilesSlider = new Swiper(".slider-profiles-more", {
    direction: "horizontal",
    loop: true,
    spaceBetween: 12,
    slidesPerView: 6,
    slidesPerGroup: 1,
    speed: 500,
    effect: "slider",

    autoplay: {
      delay: 3000,
      disableOnInteraction: true,
    },

    navigation: {
      nextEl: ".swiper-next",
      prevEl: ".swiper-prev",
    },

    pagination: {
      el: ".swiper-pagination",
      clickable: true,
    },

    on: {
      init() {
        this.el.addEventListener("mouseenter", () => {
          this.autoplay.stop();
        });

        this.el.addEventListener("mouseleave", () => {
          this.autoplay.start();
        });
      },
    },

    //! Адаптив слайдера
    breakpoints: {
      1200: {
        slidesPerView: 7,
      },

      1025: {
        slidesPerView: 6,
      },

      1024: {
        slidesPerView: 5,
      },

      601: {
        slidesPerView: 4,
      },

      500: {
        slidesPerView: 3,
      },

      0: {
        slidesPerView: 2,
        spaceBetween: 8,
      },
    },
  });

  /* ------------------- Profile Slider -------------------- */
  const profileSlider = new Swiper(".profile-slider", {
    direction: "horizontal",
    loop: true,
    spaceBetween: 0,
    slidesPerView: 1,
    slidesPerGroup: 1,
    speed: 500,
    effect: "slider",

    pagination: {
      el: ".swiper-pagination",
      clickable: true,
    },
  });

  /* ------------------- Show More Videos -------------------- */
  const showVideosLink = document.querySelector(".show-videos");
  const profileVideosMore = document.querySelector(".profile__more-videos");

  if (showVideosLink && profileVideosMore) {
    // Проверяем наличие элементов
    showVideosLink.addEventListener("click", function () {
      if (profileVideosMore.classList.contains("show")) {
        profileVideosMore.classList.remove("show");
        showVideosLink.textContent = "All videos";
      } else {
        profileVideosMore.classList.add("show");
        showVideosLink.textContent = "Hide";
      }
    });
  }

  /* ------------------- Verification Messages -------------------- */
  const resendEmail1 = document.querySelectorAll(".resend-email1");
  const resendEmail2 = document.querySelectorAll(".resend-email2");
  const changeEmail = document.querySelectorAll(".change-email");
  const verifStep1 = document.querySelectorAll(".verif-step1");
  const verifStep2 = document.querySelectorAll(".verif-step2");
  const verifStep3 = document.querySelectorAll(".verif-step3");

  // Add event listeners to each element in NodeList
  resendEmail1.forEach((element) => {
    element.addEventListener("click", function () {
      verifStep1.forEach((step) => step.classList.remove("active"));
      verifStep2.forEach((step) => step.classList.add("active"));
    });
  });

  resendEmail2.forEach((element) => {
    element.addEventListener("click", function () {
      verifStep2.forEach((step) => step.classList.remove("active"));
      verifStep1.forEach((step) => step.classList.add("active"));
    });
  });

  changeEmail.forEach((element) => {
    element.addEventListener("click", function () {
      verifStep2.forEach((step) => step.classList.remove("active"));
      verifStep3.forEach((step) => step.classList.add("active"));
    });
  });

  //! End Scripts
});
